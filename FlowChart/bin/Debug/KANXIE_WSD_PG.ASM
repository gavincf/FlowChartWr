






C_KANXIE_VERT_DIF EQU 9
C_KANXIE_HORI_DIF EQU 9

C_KANXIE_HORI_CMP EQU 10


C_KANXIE_CNT EQU 4
C_KANXIE_CNT2 EQU 4






L_KANXIE_OV:
 LDA R_KANXIE_OV_DLYCNT
 BEQ L_KANXIE_OV_S20
 INC R_KANXIE_OV_DLYCNT
 BNE L_KANXIE_OV_S20

 MR_AVR_X_EN
 MR_AVR_Y_EN
 MR_AVR_Z_EN


 STZ R_KANXIE_CHK_STEP

 LDA R_SWIPE_FLAG
 CMP #1
 BNE L_KANXIE_OV_S20



L_KANXIE_OV_S20:
 RTS




CHK_KANXIE:


 LDA R_1ST_AVR_CNT
 CMP #16
 BCC CHK_KANXIE_EXIT_J1

 LDA R_KANXIE_STEP_DLYCNT
 BEQ CHK_KANXIE_S010
 INC R_KANXIE_STEP_DLYCNT
 BEQ CHK_KANXIE_S010


CHK_KANXIE_EXIT_J1:
 
 RTS
 
CHK_KANXIE_S010:




 LDX R_GSENSOR_SAVEP
 BNE CHK_KANXIE_S011
 LDX #32
CHK_KANXIE_S011:
 DEX

 LDA R_SAVEX_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_HORIZONTAL_VAL_P
 LDA R_SAVEY_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_VERTICAL_VAL_P
 LDA R_SAVEZ_BASE,X

 STA R_ZVAL

 LDA R_KANXIE_CHK_STEP
 ASL A
 TAX
 JMP (CHK_KANXIE_TBL,X)
CHK_KANXIE_TBL:
 DW CHK_KANXIE_0
 DW CHK_KANXIE_1
 DW CHK_KANXIE_2
 DW CHK_KANXIE_3
 DW CHK_KANXIE_EXIT

CHK_KANXIE_0:
 LDA R_VERTICAL_VAL_P 
 CMP R_VERTICAL_AVR_P
 BCC CHK_KANXIE_0_VERT_S10
 SBC R_VERTICAL_AVR_P
 CMP #C_KANXIE_VERT_DIF
 BCC CHK_KANXIE_0_RECOUNT

 BRA CHK_KANXIE_0_HORT
CHK_KANXIE_0_VERT_S10:
 SEC
 LDA R_VERTICAL_AVR_P
 SBC R_VERTICAL_VAL_P
 CMP #C_KANXIE_VERT_DIF
 BCC CHK_KANXIE_0_RECOUNT

CHK_KANXIE_0_HORT:
 LDA R_HORIZONTAL_AVR_P 
 CMP R_HORIZONTAL_VAL_P
 BCC CHK_KANXIE_0_RECOUNT
 SBC R_HORIZONTAL_VAL_P
 CMP #C_KANXIE_HORI_DIF
 BCC CHK_KANXIE_0_RECOUNT

 LDA R_HORIZONTAL_VAL_P
 STA R_LAST_HORIZONTAL 


 
 MR_SET_KANXIE_IDX 0,1
 MR_SET_KANXIE_OV
 MR_AVR_X_DIS
 MR_AVR_Y_DIS
 MR_AVR_Z_EN

 JMP CHK_KANXIE_EXIT

CHK_KANXIE_0_RECOUNT:
 STZ R_KANXIE_CNT

CHK_KANXIE_EXIT_J4:
 JMP CHK_KANXIE_EXIT

CHK_KANXIE_1:

 LDA R_VERTICAL_VAL_P 
 CMP R_VERTICAL_AVR_P
 BCC CHK_KANXIE_1_VERT_S10
 SBC R_VERTICAL_AVR_P
 CMP #C_KANXIE_VERT_DIF+25
 BCC CHK_KANXIE_1_RECOUNT

 BRA CHK_KANXIE_1_HORT
CHK_KANXIE_1_VERT_S10:
 SEC
 LDA R_VERTICAL_AVR_P
 SBC R_VERTICAL_VAL_P
 CMP #C_KANXIE_VERT_DIF+25
 BCC CHK_KANXIE_1_RECOUNT

CHK_KANXIE_1_HORT:
 LDA R_LAST_HORIZONTAL 
 CMP R_HORIZONTAL_VAL_P
 BCC CHK_KANXIE_1_RECOUNT
 SBC R_HORIZONTAL_VAL_P
 CMP #C_KANXIE_HORI_CMP 
 BCC CHK_KANXIE_1_RECOUNT

 LDA R_LAST_HORIZONTAL
 CMP #C_SHIFT_PLUS-40
 BCC CHK_KANXIE_1_S010
 
 LDA R_HORIZONTAL_VAL_P
 STA R_LAST_HORIZONTAL 

CHK_KANXIE_1_S010:
 
 MR_SET_KANXIE_IDX 0,2
 MR_SET_KANXIE_OV
 STZ R_KANXIE_CNT



 M_SET_KEYCH0_FLAG
 LDA #1
 STA WB_KEYCH_CODE
 LDA #1
 STA R_SWIPE_FLAG

 JMP CHK_KANXIE_EXIT
CHK_KANXIE_1_RECOUNT:
 STZ R_KANXIE_CNT

 
 JMP CHK_KANXIE_EXIT
 
CHK_KANXIE_2:

 LDA R_LAST_HORIZONTAL 
 CMP R_HORIZONTAL_VAL_P
 BCC CHK_KANXIE_2_RECOUNT
 SBC R_HORIZONTAL_VAL_P
 CMP #C_KANXIE_HORI_CMP 
 BCC CHK_KANXIE_2_RECOUNT

 LDA R_LAST_HORIZONTAL
 CMP #C_SHIFT_PLUS-40
 BCC CHK_KANXIE_2_S010
 
 LDA R_HORIZONTAL_VAL_P
 STA R_LAST_HORIZONTAL 

CHK_KANXIE_2_S010:
 INC R_KANXIE_CNT
 LDA R_KANXIE_CNT
 CMP #2
 BCC CHK_KANXIE_2_J6

 MR_SET_KANXIE_IDX 256-2,3
 MR_SET_KANXIE_OV
 STZ R_KANXIE_CNT


 JMP CHK_KANXIE_EXIT
CHK_KANXIE_2_RECOUNT:
 STZ R_KANXIE_CNT

 
CHK_KANXIE_2_J6:
 JMP CHK_KANXIE_EXIT
 
CHK_KANXIE_3: 

 LDA R_VERTICAL_AVR_P
 CMP R_VERTICAL_VAL_P 
 BCC CHK_KANXIE_3_VERT_S10
 SBC R_VERTICAL_VAL_P
 CMP #30
 BCC CHK_KANXIE_3_RECOUNT

 BRA CHK_KANXIE_3_S100
CHK_KANXIE_3_VERT_S10:
 SEC
 LDA R_VERTICAL_VAL_P
 SBC R_VERTICAL_AVR_P
 CMP #30
 BCC CHK_KANXIE_3_RECOUNT
 
CHK_KANXIE_3_S100:

 INC R_KANXIE_CNT
 LDA R_KANXIE_CNT
 CMP #2
 BCC CHK_KANXIE_EXIT_J5




 MR_SET_KANXIE_IDX 256-6,0

 MR_STOP_KANXIE_DLYCNT
 MR_AVR_X_EN
 MR_AVR_Y_EN
 MR_AVR_Z_EN
 STZ R_SWIPE_FLAG



CHK_KANXIE_EXIT_J5:
 JMP CHK_KANXIE_EXIT
CHK_KANXIE_3_RECOUNT: 
 STZ R_KANXIE_CNT
 
 JMP CHK_KANXIE_EXIT
 
CHK_KANXIE_EXIT:

 RTS
