
;detect g -sensor
;X MOV; 1g->0
;USED 2 step detect:
;0,start motion;start motion;>800ms
;1,ending motion detecting

;@+/-4g;12bit,
;C_3AXIS_X EQU 0+C_SHIFT_PLUS
;C_3AXIS_Z EQU 0+C_SHIFT_PLUS

C_3AXIS3_Y1 EQU 32+C_SHIFT_PLUS
C_3AXIS3_Y2 EQU -32+C_SHIFT_PLUS

C_3AXIS3_Y EQU 0+C_SHIFT_PLUS

C_3AXIS3_TOLERENCE EQU 10


;==================================
;check 
;===================================
;===================================
; ; @FXF15
;===================================
L_3AXIS3_OV:
	LDA	R_3AXIS3_OV_DLYCNT
	BEQ	L_3AXIS3_OV_S20
	INC	R_3AXIS3_OV_DLYCNT
	BNE	L_3AXIS3_OV_S20
	
	STZ	R_3AXIS3_CHK_STEP
	
L_3AXIS3_OV_S20:
	RTS


;===================================
;WAITKEY_GAP2B_PCC
;===================================
CHK_3AXIS3:
;
	LDA	R_1ST_AVR_CNT
	CMP	#16
	BCC	CHK_3AXIS3_EXIT_J1

	LDA	R_3AXIS3_STEP_DLYCNT
	BEQ	CHK_3AXIS3_S010
	INC	R_3AXIS3_STEP_DLYCNT
	BEQ	CHK_3AXIS3_S010

;COUNTTING for next step	
CHK_3AXIS3_EXIT_J1:
	
	JMP	CHK_3AXIS3_EXIT
	
CHK_3AXIS3_S010:
	LDX	R_Gsensor_SaveP
	BNE	CHK_3AXIS3_S011
	LDX	#32
CHK_3AXIS3_S011:
	DEX

	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	R_XVAL;;X
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	R_YVAL;;Y
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	R_ZVAL;;Z
;

;
;	LDA	R_3AXIS2_CHK_STEP ;for 3axis2
;	BNE	CHK_3AXIS3_EXIT_J1

	LDA	R_3AXIS3_CHK_STEP
	ASL	A
	TAX
	JMP	(CHK_3AXIS3_TBL,X)
CHK_3AXIS3_TBL:
	DW	CHK_3AXIS3_0;check action start
	DW	CHK_3AXIS3_1;
	DW	CHK_3AXIS3_EXIT;

CHK_3AXIS3_0:;default = 0;;OTHER MODE;
	M_int_Inside_plus R_YVAL,#(C_3AXIS3_Y1-C_3AXIS3_TOLERENCE),#(C_3AXIS3_Y1+C_3AXIS3_TOLERENCE)
	BEQ	CHK_3AXIS3_0_S100
	M_int_Inside_plus R_YVAL,#(C_3AXIS3_Y2-C_3AXIS3_TOLERENCE),#(C_3AXIS3_Y2+C_3AXIS3_TOLERENCE)
	BEQ	CHK_3AXIS3_0_S100

	JMP	CHK_3AXIS3_0_RELEASE

CHK_3AXIS3_0_S100:

	INC	R_3AXIS3_CNT
	BNE	CHK_3AXIS3_0_EXIT
	DEC	R_3AXIS3_CNT
CHK_3AXIS3_0_EXIT:
	JMP	CHK_3AXIS3_EXIT

CHK_3AXIS3_0_RELEASE:;release

	LDA	R_3AXIS3_CNT
	CMP	#8 ; *48MS
	BCC	CHK_3AXIS3_0_RELEASE1
	STZ	R_3AXIS3_CNT
;
	MR_SET_3AXIS3_IDX 256-3,1;delay 150ms
	MR_SET_3AXIS3_OV ;500ms

	JMP	CHK_3AXIS3_EXIT

CHK_3AXIS3_0_RELEASE1:
	STZ	R_3AXIS3_CNT ;restart
	JMP	CHK_3AXIS3_EXIT

CHK_3AXIS3_1:
	M_int_Inside_plus R_YVAL,#(C_3AXIS3_Y-C_3AXIS3_TOLERENCE),#(C_3AXIS3_Y+C_3AXIS3_TOLERENCE)
	BNE	CHK_3AXIS3_EXIT

	MR_SET_3AXIS3_OV
	
	INC	R_3AXIS3_CNT
	LDA	R_3AXIS3_CNT
	CMP	#6
	BCC	CHK_3AXIS3_EXIT
	STZ	R_3AXIS3_CNT

	M_SET_KEYCH0_FLAG
	LDA	#4
	STA	WB_KEYCH_CODE
	
	MR_SET_3AXIS3_IDX 0,0
	
	JMP	CHK_3AXIS3_EXIT

CHK_3AXIS3_EXIT:
	RTS
