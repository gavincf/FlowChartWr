
;detect g -sensor
;X MOV; 1g->0
;USED 2 step detect:
;0,start motion;start motion;>800ms
;1,ending motion detecting

;@+/-4g;12bit,32


C_XMOV_X_START EQU 32+C_SHIFT_PLUS
C_XMOV_Y_START EQU 0+C_SHIFT_PLUS
C_XMOV_Z_START EQU 0+C_SHIFT_PLUS

C_XMOV_X_END EQU 0+C_SHIFT_PLUS
C_XMOV_Y_END EQU 0+C_SHIFT_PLUS
C_XMOV_Z_END EQU 32+C_SHIFT_PLUS


C_XMOV_TOLERENCE EQU 8


;==================================
;check 
;===================================
;===================================
; ; @FXF15
;===================================
L_XMOV_OV:
	LDA	R_XMOV_OV_DLYCNT
	ORA	R_XMOV_OV_DLYCNT+1
	BEQ	L_XMOV_OV_S20
	INC	R_XMOV_OV_DLYCNT
	BNE	L_XMOV_OV_S20
	INC	R_XMOV_OV_DLYCNT+1
	BNE	L_XMOV_OV_S20
	
	STZ	R_XMOV_CHK_STEP
	PLAY	DI_96K+[100MSEC]+DI_96K

L_XMOV_OV_S20:
	RTS


;===================================
;WAITKEY_GAP2B_PCC
;===================================
CHK_XMOV:
;
	LDA	R_1ST_AVR_CNT
	CMP	#16
	BCC	CHK_XMOV_EXIT_J1

	LDA	R_XMOV_STEP_DLYCNT
	BEQ	CHK_XMOV_S010
	INC	R_XMOV_STEP_DLYCNT
	BEQ	CHK_XMOV_S010

;COUNTTING for next step	
CHK_XMOV_EXIT_J1:
	
	JMP	CHK_XMOV_EXIT
	
CHK_XMOV_S010:
	LDX	R_Gsensor_SaveP
	BNE	CHK_XMOV_S011
	LDX	#32
CHK_XMOV_S011:
	DEX

	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	R_XVAL;;X
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	R_YVAL;;Y
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	R_ZVAL;;Z
;

	LDA	R_XMOV_CHK_STEP
	ASL	A
	TAX
	JMP	(CHK_XMOV_TBL,X)
CHK_XMOV_TBL:
	DW	CHK_XMOV_0;check action start
	DW	CHK_XMOV_1;
	DW	CHK_XMOV_EXIT;

CHK_XMOV_0:;default = 0;;OTHER MODE;
	M_int_Inside_plus R_XVAL,#(C_XMOV_X_START-C_XMOV_TOLERENCE),#(C_XMOV_X_START+C_XMOV_TOLERENCE)
	BNE	CHK_XMOV_0_RELEASE
	M_int_Inside_plus R_YVAL,#(C_XMOV_Y_START-C_XMOV_TOLERENCE),#(C_XMOV_Y_START+C_XMOV_TOLERENCE)
	BNE	CHK_XMOV_0_RELEASE
	M_int_Inside_plus R_ZVAL,#(C_XMOV_Z_START-C_XMOV_TOLERENCE),#(C_XMOV_Z_START+C_XMOV_TOLERENCE)
	BNE	CHK_XMOV_0_RELEASE

CHK_XMOV_0_S100:

	INC	R_XMOV_CNT
	BNE	CHK_XMOV_0_S200
	DEC	R_XMOV_CNT
CHK_XMOV_0_S200:
	LDA	R_XMOV_CNT
	CMP	#10
	BNE	CHK_XMOV_EXIT1
;START
	PLAY	DI_96K
	
CHK_XMOV_EXIT1:
	JMP	CHK_XMOV_EXIT

CHK_XMOV_0_RELEASE:;release

	LDA	R_XMOV_CNT
	CMP	#8 ; *48MS
	BCC	CHK_XMOV_0_RELEASE1
	STZ	R_XMOV_CNT
;
	MR_SET_XMOV_IDX 256-3,1;delay 150ms
	MR_SET_XMOV_OV ;500ms

	JMP	CHK_XMOV_EXIT

CHK_XMOV_0_RELEASE1:
	STZ	R_XMOV_CNT ;restart
	JMP	CHK_XMOV_EXIT

CHK_XMOV_1: ;END
	M_int_Inside_plus R_XVAL,#(C_XMOV_X_END-C_XMOV_TOLERENCE),#(C_XMOV_X_END+C_XMOV_TOLERENCE)
	BNE	CHK_XMOV_EXIT
	M_int_Inside_plus R_YVAL,#(C_XMOV_Y_END-C_XMOV_TOLERENCE),#(C_XMOV_Y_END+C_XMOV_TOLERENCE)
	BNE	CHK_XMOV_EXIT
	M_int_Inside_plus R_ZVAL,#(C_XMOV_Z_END-C_XMOV_TOLERENCE),#(C_XMOV_Z_END+C_XMOV_TOLERENCE)
	BNE	CHK_XMOV_EXIT
;reach end point
	MR_SET_XMOV_OV
	
	INC	R_XMOV_CNT
	LDA	R_XMOV_CNT
	CMP	#6
	BCC	CHK_XMOV_EXIT
	STZ	R_XMOV_CNT

	M_SET_KEYCH0_FLAG
	LDA	#0
	STA	WB_KEYCH_CODE
	
	MR_SET_XMOV_IDX 0,0
	
CHK_XMOV_EXIT:
	RTS
