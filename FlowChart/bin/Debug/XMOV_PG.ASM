









C_XMOV_X_START EQU 32+C_SHIFT_PLUS
C_XMOV_Y_START EQU 0+C_SHIFT_PLUS
C_XMOV_Z_START EQU 0+C_SHIFT_PLUS

C_XMOV_X_END EQU 0+C_SHIFT_PLUS




C_XMOV_TOLERENCE EQU 8








L_XMOV_OV:
 LDA R_XMOV_OV_DLYCNT
 ORA R_XMOV_OV_DLYCNT+1
 BEQ L_XMOV_OV_S20
 INC R_XMOV_OV_DLYCNT
 BNE L_XMOV_OV_S20
 INC R_XMOV_OV_DLYCNT+1
 BNE L_XMOV_OV_S20
 
 STZ R_XMOV_CHK_STEP
 PLAY DI_96K+[100MSEC]+DI_96K

L_XMOV_OV_S20:
 RTS





CHK_XMOV:

 LDA R_1ST_AVR_CNT
 CMP #16
 BCC CHK_XMOV_EXIT_J1

 LDA R_XMOV_STEP_DLYCNT
 BEQ CHK_XMOV_S010
 INC R_XMOV_STEP_DLYCNT
 BEQ CHK_XMOV_S010


CHK_XMOV_EXIT_J1:
 
 JMP CHK_XMOV_EXIT
 
CHK_XMOV_S010:
 LDX R_GSENSOR_SAVEP
 BNE CHK_XMOV_S011
 LDX #32
CHK_XMOV_S011:
 DEX

 LDA R_SAVEX_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_XVAL
 LDA R_SAVEY_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_YVAL
 LDA R_SAVEZ_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_ZVAL


 LDA R_XMOV_CHK_STEP
 ASL A
 TAX
 JMP (CHK_XMOV_TBL,X)
CHK_XMOV_TBL:
 DW CHK_XMOV_0
 DW CHK_XMOV_1
 DW CHK_XMOV_EXIT

CHK_XMOV_0:
 M_INT_INSIDE_PLUS R_XVAL,#(C_XMOV_X_START-C_XMOV_TOLERENCE),#(C_XMOV_X_START+C_XMOV_TOLERENCE)
 BNE CHK_XMOV_0_RELEASE
 M_INT_INSIDE_PLUS R_YVAL,#(C_XMOV_Y_START-C_XMOV_TOLERENCE),#(C_XMOV_Y_START+C_XMOV_TOLERENCE)
 BNE CHK_XMOV_0_RELEASE
 M_INT_INSIDE_PLUS R_ZVAL,#(C_XMOV_Z_START-C_XMOV_TOLERENCE),#(C_XMOV_Z_START+C_XMOV_TOLERENCE)
 BNE CHK_XMOV_0_RELEASE

CHK_XMOV_0_S100:

 INC R_XMOV_CNT
 BNE CHK_XMOV_0_S200
 DEC R_XMOV_CNT
CHK_XMOV_0_S200:
 LDA R_XMOV_CNT
 CMP #10
 BNE CHK_XMOV_EXIT1

 PLAY DI_96K
 
CHK_XMOV_EXIT1:
 JMP CHK_XMOV_EXIT

CHK_XMOV_0_RELEASE:

 LDA R_XMOV_CNT
 CMP #8 
 BCC CHK_XMOV_0_RELEASE1
 STZ R_XMOV_CNT

 MR_SET_XMOV_IDX 256-3,1
 MR_SET_XMOV_OV 

 JMP CHK_XMOV_EXIT

CHK_XMOV_0_RELEASE1:
 STZ R_XMOV_CNT 
 JMP CHK_XMOV_EXIT

CHK_XMOV_1: 
 M_INT_INSIDE_PLUS R_XVAL,#(C_XMOV_X_END-C_XMOV_TOLERENCE),#(C_XMOV_X_END+C_XMOV_TOLERENCE)
 BNE CHK_XMOV_EXIT





 MR_SET_XMOV_OV
 
 INC R_XMOV_CNT
 LDA R_XMOV_CNT
 CMP #6
 BCC CHK_XMOV_EXIT
 STZ R_XMOV_CNT

 M_SET_KEYCH0_FLAG
 LDA #0
 STA WB_KEYCH_CODE
 
 MR_SET_XMOV_IDX 0,0
 
CHK_XMOV_EXIT:
 RTS
