









C_ZMOV_X_START EQU 0+C_SHIFT_PLUS
C_ZMOV_Y_START EQU 0+C_SHIFT_PLUS
C_ZMOV_Z_START EQU 32+C_SHIFT_PLUS



C_ZMOV_Z_END EQU 0+C_SHIFT_PLUS


C_ZMOV_TOLERENCE EQU 8








L_ZMOV_OV:
 LDA R_ZMOV_OV_DLYCNT
 ORA R_ZMOV_OV_DLYCNT+1
 BEQ L_ZMOV_OV_S20
 INC R_ZMOV_OV_DLYCNT
 BNE L_ZMOV_OV_S20
 INC R_ZMOV_OV_DLYCNT+1
 BNE L_ZMOV_OV_S20
 
 STZ R_ZMOV_CHK_STEP
 PLAY DI_96K+[100MSEC]+DI_96K

L_ZMOV_OV_S20:
 RTS





CHK_ZMOV:

 LDA R_1ST_AVR_CNT
 CMP #16
 BCC CHK_ZMOV_EXIT_J1

 LDA R_ZMOV_STEP_DLYCNT
 BEQ CHK_ZMOV_S010
 INC R_ZMOV_STEP_DLYCNT
 BEQ CHK_ZMOV_S010


CHK_ZMOV_EXIT_J1:
 
 JMP CHK_ZMOV_EXIT
 
CHK_ZMOV_S010:
 LDX R_GSENSOR_SAVEP
 BNE CHK_ZMOV_S011
 LDX #32
CHK_ZMOV_S011:
 DEX

 LDA R_SAVEX_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_XVAL
 LDA R_SAVEY_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_YVAL
 LDA R_SAVEZ_BASE,X
 CLC
 ADC #C_SHIFT_PLUS
 STA R_ZVAL


 LDA R_ZMOV_CHK_STEP
 ASL A
 TAX
 JMP (CHK_ZMOV_TBL,X)
CHK_ZMOV_TBL:
 DW CHK_ZMOV_0
 DW CHK_ZMOV_1
 DW CHK_ZMOV_EXIT

CHK_ZMOV_0:
 M_INT_INSIDE_PLUS R_XVAL,#(C_ZMOV_X_START-C_ZMOV_TOLERENCE),#(C_ZMOV_X_START+C_ZMOV_TOLERENCE)
 BNE CHK_ZMOV_0_RELEASE
 M_INT_INSIDE_PLUS R_YVAL,#(C_ZMOV_Y_START-C_ZMOV_TOLERENCE),#(C_ZMOV_Y_START+C_ZMOV_TOLERENCE)
 BNE CHK_ZMOV_0_RELEASE
 M_INT_INSIDE_PLUS R_ZVAL,#(C_ZMOV_Z_START-C_ZMOV_TOLERENCE),#(C_ZMOV_Z_START+C_ZMOV_TOLERENCE)
 BNE CHK_ZMOV_0_RELEASE

CHK_ZMOV_0_S100:

 INC R_ZMOV_CNT
 BNE CHK_ZMOV_0_S200
 DEC R_ZMOV_CNT
CHK_ZMOV_0_S200:
 LDA R_ZMOV_CNT
 CMP #10
 BNE CHK_ZMOV_EXIT1

 PLAY DI_96K
 
CHK_ZMOV_EXIT1:
 JMP CHK_ZMOV_EXIT

CHK_ZMOV_0_RELEASE:

 LDA R_ZMOV_CNT
 CMP #8 
 BCC CHK_ZMOV_0_RELEASE1
 STZ R_ZMOV_CNT

 MR_SET_ZMOV_IDX 256-3,1
 MR_SET_ZMOV_OV 

 JMP CHK_ZMOV_EXIT

CHK_ZMOV_0_RELEASE1:
 STZ R_ZMOV_CNT 
 JMP CHK_ZMOV_EXIT

CHK_ZMOV_1: 




 M_INT_INSIDE_PLUS R_ZVAL,#(C_ZMOV_Z_END-C_ZMOV_TOLERENCE),#(C_ZMOV_Z_END+C_ZMOV_TOLERENCE)
 BNE CHK_ZMOV_EXIT

 MR_SET_ZMOV_OV
 
 INC R_ZMOV_CNT
 LDA R_ZMOV_CNT
 CMP #6
 BCC CHK_ZMOV_EXIT
 STZ R_ZMOV_CNT

 M_SET_KEYCH0_FLAG
 LDA #2
 STA WB_KEYCH_CODE
 
 MR_SET_ZMOV_IDX 0,0
 
CHK_ZMOV_EXIT:
 RTS
