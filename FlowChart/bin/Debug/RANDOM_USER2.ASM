
.IF ( C_RANDOM_GP_USED .EQ. 1)

RANDOM_GP_BUF_INIT:
 LDX #0
RANDOM_GP_BUF_INIT_S10:
 LDA #0FFH
 STA R_RANDOM_GP_BUF,X 
 INX
 CPX #C_RANDOM_GP_CNT
 BCC RANDOM_GP_BUF_INIT_S10
 
 RTS







L_GET_RANDOM_GP:

 LDX R_RANDOM_GP_NO
 LDA R_RANDOM_GP_BUF,X
 CMP #0FFH
 BNE L_GET_RANDOM_GP_NEXT 

 LDA T_RANDOM_BUF_MAX,X
 TAX
 LDA T_RANDOM_TABLE_CNT,X
 CMP #1
 BEQ L_GET_RANDOM_GP_S10
 STA REG_EA
 JSR BK0_GET_RANDOM0 
 LDA REG_EA
 CMP RANDOM0_0_BK
 BNE L_GET_RANDOM_GP_S20
 INC REG_EA
 CPX REG_EA
 BNE L_GET_RANDOM_GP_S20
 STZ REG_EA
 BRA L_GET_RANDOM_GP_S20
L_GET_RANDOM_GP_S10:
 STZ REG_EA

L_GET_RANDOM_GP_S20:
 LDA REG_EA
 STA RANDOM0_0_BK
 

 STZ REG_HL 
 LDX <R_RANDOM_GP_NO
L_GET_RANDOM_GP_S21:
 LDA REG_EA 
 BEQ L_GET_RANDOM_GP_S30
 LDA T_RANDOM_BUF_MAX,X
 CLC
 ADC REG_HL
 STA REG_HL
 DEC REG_EA 
 BRA L_GET_RANDOM_GP_S21
L_GET_RANDOM_GP_S30:
 LDA REG_HL
 STA R_RANDOM_GP_BUF,X
 BRA L_GET_RANDOM_GP_S100

L_GET_RANDOM_GP_NEXT: 
 LDX <R_RANDOM_GP_NO
 LDA R_RANDOM_GP_BUF,X 
 CLC
 ADC #1
 STA R_RANDOM_GP_BUF,X
 
L_GET_RANDOM_GP_S100:
 LDX <R_RANDOM_GP_NO
 LDY R_RANDOM_GP_BUF,X

 LDA T_RANDOM_BUF_MAX,X
 ASL A
 TAX
 LDA BK0_RANDOM_TBL,X
 STA REG_EA
 INX
 LDA BK0_RANDOM_TBL,X
 STA REG_HL

 LDA (<REG_EA),Y
 CMP #0FFH
 BNE L_GET_RANDOM_GP_EXIT
 LDX <R_RANDOM_GP_NO
 LDA #0
 STA <R_RANDOM_GP_BUF,X 
 BRA L_GET_RANDOM_GP_S100
L_GET_RANDOM_GP_EXIT:
 TAY 

 RTS






L_GET_RANDOM_GP_DATA:
 LDA <R_RANDOM_GP_NO
 ASL A
 TAX
 LDA T_RANDOM_GROUP,X 
 STA <REG_EA
 INX
 LDA T_RANDOM_GROUP,X 
 STA <REG_HL


 LDA (<REG_EA),Y



 RTS


.ENDIF 
