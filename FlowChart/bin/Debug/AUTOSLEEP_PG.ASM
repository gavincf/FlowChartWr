
L_AUTOCNT:
 LDA WB_AUTOCNT0
.IF ( C_AUTOSLEEP_2B .EQ. 1 )
 ORA WB_AUTOCNT01
.ENDIF
 BEQ L_AUTOCNT_S100
 
 INC WB_AUTOCNT0
 BNE L_AUTOCNT_S100
.IF ( C_AUTOSLEEP_2B .EQ. 1 )
 INC WB_AUTOCNT01
 BNE L_AUTOCNT_S100
.ENDIF


 LDA #C_AUTOCNT_BIT
 TSB DP_USER_FLAG_B
L_AUTOCNT_S100:
 JMP L_AUTOCNT_RET


.IF ( C_AUTOSLEEP_WAITKEY_EN .EQ. 1 )

BK0_AUTOCNT_SOLVE_MUTE_WITHCHK:

.IF ( C_MS1_ENABLE .EQ. 1 )
 JSR CHK_MIDI_STATUS
 BNE BK0_AUTOCNT_SOLVE
.ENDIF 

.IF (C_SPCH1_ENABLE .EQ. 1)
 CHK_BUSY_CH1
 BNE BK0_AUTOCNT_SOLVE
.ENDIF

.IF (C_SPCH2_ENABLE .EQ. 1)
 CHK_BUSY_CH2
 BNE BK0_AUTOCNT_SOLVE
.ENDIF

.IF (C_SPCH3_ENABLE .EQ. 1)
 CHK_BUSY_CH3
 BNE BK0_AUTOCNT_SOLVE
.ENDIF

 BRA BK0_AUTOCNT_SOLVE_MUTE
 
BK0_AUTOCNT_SOLVE:
 LDA AUTOSLEEP_FLAG
 CMP AUTOSLEEP_FLAG_BK
 BEQ BK0_AUTOCNT_SOLVE_END1
 STA AUTOSLEEP_FLAG_BK
 CMP #0
 BNE BK0_AUTOCNT_SOLVE_S10

BK0_AUTOCNT_SOLVE_MUTE:


 MR_SET_AUTOCNT2
 
BK0_AUTOCNT_SOLVE_END1:
 RTS
BK0_AUTOCNT_SOLVE_S01:
 MR_SET_AUTOCNT2_TRYME
 RTS
BK0_AUTOCNT_SOLVE_S10:
 LDA AUTOSLEEP_FLAG
 CMP #C_AUTOSLEEP_MS1_BIT
 BEQ BK0_AUTOCNT_SOLVE_S11 
 CMP #C_AUTOSLEEP_DRUMP_BIT | C_AS_DRUMP_RP_CH_BIT
 BEQ BK0_AUTOCNT_SOLVE_S12 

 MR_STOP_AUTOCNT
 
 RTS
BK0_AUTOCNT_SOLVE_S11:


BK0_AUTOCNT_SOLVE_S12:

 MR_SET_AUTOCNT3
 
BK0_AUTOCNT_SOLVE_END:
 RTS


BK0_AUTOSLEEP_KEYIN:





 

 
 LDA AUTOSLEEP_FLAG
 CMP #C_AUTOSLEEP_MS1_BIT
 BEQ BK0_AUTOSLEEP_KEYIN_S20 
 CMP #C_AUTOSLEEP_DRUMP_BIT | C_AS_DRUMP_RP_CH_BIT
 BEQ BK0_AUTOSLEEP_KEYIN_S20 
 
 RTS
BK0_AUTOSLEEP_KEYIN_S20:
 
 MR_SET_AUTOCNT3
 
 RTS




















BK0_AUTOSLEEP_INIT:
 STZ <AUTOSLEEP_FLAG
 STZ <AUTOSLEEP_FLAG_BK
 RTS

BK0_AUTOSLEEP_NOTEON_BUSY_X:
 LDA BK0_AUTOSLEEP_NOTEON_TBL,X
 TSB <AUTOSLEEP_FLAG
 RTS
BK0_AUTOSLEEP_NOTEON_TBL:
 DB C_BIT4
 DB C_BIT5
 DB C_BIT6
 DB C_BIT7

.ENDIF  
