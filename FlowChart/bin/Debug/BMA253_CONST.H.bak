

;=========================================================================
; CONST
;=========================================================================

;----------------------------------------------------------
;POR initial
;----------------------------------------------------------
	
;		BMA222E_SoftReset ;wake up susbend mode
;		;BMA222E_SetRangeTo8G - no need
;		JSR BMA222E_SetFilterBandwidth
;		
;	JSR	F_BMA253_Clear_Int
;;TAP setting
;		MR_BMA222E_WR INT_OUT_CTRL,02H
;		MR_BMA222E_WR INT_MAP_0,C_BIT5
;		MR_BMA222E_WR INT_RST_LATCH,87H	;Reset+Latch
;		MR_BMA222E_WR INT_8,00H	;TAG SETTING
;		MR_BMA222E_WR INT_9,46H	;6*0.125mg(4G range);TAP THRESHOLD level
;	;S TAP not enable yet 
;		JSR	F_BMA253_Enable_Int;start


;----------------------------------------------------------
;each 21.33ms call below subroutine to get the XYZ data
;----------------------------------------------------------
;	JSR	BMA222E_ReadXYZ

C_BMA253_HWSPI_EN EQU 1
C_BMA222E_8B_EN EQU 1

;=================================
;BMA223 register address
;=================================
;---------------------------------------------------
; gavin
;------------------------------------------------
BGW_CHIPID	EQU	00H
ACCD_X_LSB	EQU	02H
ACCD_X_MSB	EQU	03H
ACCD_Y_LSB	EQU	04H
ACCD_Y_MSB	EQU	05H
ACCD_Z_LSB	EQU	06H
ACCD_Z_MSB	EQU	07H
ACCD_TEMP		EQU	08H
;
INT_STATUS_0 EQU 09H
C_BMA223_FLAT_INT EQU	C_BIT7
C_BMA223_ORIENT_INT EQU	C_BIT6
C_BMA223_S_TAP_INT EQU	C_BIT5
C_BMA223_D_TAP_INT EQU	C_BIT4
C_BMA223_SLO_NO_MOT_INT EQU	C_BIT3
C_BMA223_SLOPE_INT EQU	C_BIT2
C_BMA223_HIGH_INT EQU	C_BIT1
C_BMA223_LOW_INT EQU	C_BIT0
;
INT_STATUS_1 EQU 0AH
INT_STATUS_2 EQU 0BH
INT_STATUS_3 EQU 0CH
FIFO_STATUS EQU	0EH
PMU_RANGE		EQU 0FH
PMU_BW		EQU	10H
PMU_LPW		EQU	11H
PMU_LOW_POWER EQU 12H
ACCD_HBW	EQU	13H
BGW_SOFTRESET EQU	14H
INT_EN_0 		EQU	16H
INT_EN_1 		EQU	17H
INT_EN_2 		EQU	18H
INT_MAP_0		EQU	19H
INT_MAP_1		EQU	1AH
INT_MAP_2		EQU	1BH
INT_SRC			EQU	1EH
INT_OUT_CTRL EQU 20H
INT_RST_LATCH EQU 21H
INT_0			EQU	22H
INT_1			EQU	23H
INT_2			EQU	24H
INT_3			EQU	25H
INT_4			EQU	26H
INT_5			EQU	27H
INT_6			EQU	28H
INT_7			EQU	29H
INT_8			EQU	2AH
INT_9			EQU	2BH
INT_A			EQU	2CH
INT_B			EQU	2DH
INT_C			EQU	2EH
INT_D			EQU	2FH
FIFO_CONFIG_0 EQU 30H
PMU_SELE_TEST EQU	32H
TRIM_NVM_CTRL EQU	33H
BGW_SPI3_WDT	EQU	34H
OFC_CTRL			EQU	36H
OFC_SETTING		EQU	37H
OFC_OFFSET_X	EQU	38H
OFC_OFFSET_Y	EQU	39H
OFC_OFFSET_Z	EQU	3AH
TRM_GP0				EQU	3BH
TRM_GP1				EQU	3CH
FIFO_CONFIG_1	EQU	3EH
FIFO_DATA			EQU	3FH

;========================================
;--------------------------------------------------------------------
; --- Labels/Constants ---
;define by Garfield
;--------------------------------------------------------------------
C_SUCCESS	EQU	00H
	
C_BMA253_RANGE	EQU	05H	;4G range

C_BMA253_STAND	EQU	32	;4G static value
C_BMA253_STANDL	EQU	25	
C_BMA253_STANDH	EQU	39
C_BMA253_HALF_G	EQU	16
C_BMA253_PMU_BW	EQU	0CH	;125Hz
C_BMA253_UNFILTERED	EQU	80H	;unfilter
C_BMA253_FILTERED	EQU	00H	;filter enable

C_BMA253_NORMALMODE	EQU	00H	;normal mode
C_BMA253_INT_CTRL	EQU	00H	;push-pull,active low
	
C_BMA253_CHIP_ID	EQU	FAH
C_BMA253_CHIP_ADDR	EQU	0
C_BMA253_X_LSB_ADDR	EQU	02H
C_BMA253_X_MSB_ADDR	EQU	03H
C_BMA253_Y_LSB_ADDR	EQU	04H
C_BMA253_Y_MSB_ADDR	EQU	05H
C_BMA253_Z_LSB_ADDR	EQU	06H
C_BMA253_Z_MSB_ADDR	EQU	07H
C_BMA253_TEMP_ADDR	EQU	08H
C_BMA253_STAT1_ADDR	EQU	09H
C_BMA253_STAT2_ADDR	EQU	0AH
C_BMA253_STAT_TAP_SLOPE_ADDR	EQU	0BH
C_BMA253_STAT_ORIENT_HIGH_ADDR	EQU	0CH
C_BMA253_STAT_FIFO_ADDR			EQU	0EH
C_BMA253_RANGE_SELECT_ADDR		EQU	0FH
C_BMA253_BW_SELECT_ADDR			EQU	10H
C_BMA253_MODE_CTRL_ADDR			EQU	11H
C_BMA253_LOW_NOISE_CTRL_ADDR	EQU	12H
C_BMA253_DATA_CTRL_ADDR			EQU	13H
C_BMA253_RST_ADDR	EQU	14H
C_BMA253_INTR_ENABLE1_ADDR		EQU	16H
C_BMA253_INTR_ENABLE2_ADDR		EQU	17H
C_BMA253_INTR_SLOW_NO_MOTION_ADDR	EQU	18H
C_BMA253_INTR1_PAD_SELECT_ADDR	EQU	19H
C_BMA253_INTR_DATA_SELECT_ADDR	EQU	1AH
C_BMA253_INTR2_PAD_SELECT_ADDR	EQU	1BH
C_BMA253_INTR_SOURCE_ADDR		EQU	1Eh
C_BMA253_INTR_SET_ADDR			EQU	20H
C_BMA253_INTR_CTRL_ADDR			EQU	21H
C_BMA253_LOW_DURN_ADDR			EQU	22H
C_BMA253_LOW_THRES_ADDR			EQU	23H
C_BMA253_LOW_HIGH_HYST_ADDR 	EQU	24H
C_BMA253_HIGH_DURN_ADDR			EQU	25H
C_BMA253_HIGH_THRES_ADDR		EQU	26H
C_BMA253_SLOPE_DURN_ADDR		EQU	27H
C_BMA253_SLOPE_THRES_ADDR		EQU	28H
C_BMA253_SLOW_NO_MOTION_THRES_ADDR	EQU	29H
C_BMA253_TAP_PARAM_ADDR			EQU	2AH
C_BMA253_TAP_THRES_ADDR			EQU	2BH
C_BMA253_ORIENT_PARAM_ADDR		EQU	2CH
C_BMA253_THETA_BLOCK_ADDR		EQU	2DH
C_BMA253_THETA_FLAT_ADDR		EQU	2EH
C_BMA253_FLAT_HOLD_TIME_ADDR	EQU	2FH
C_BMA253_FIFO_WML_TRIG  		EQU	30H
C_BMA253_SELFTEST_ADDR			EQU	32H
C_BMA253_EEPROM_CTRL_ADDR 		EQU	33H
C_BMA253_SERIAL_CTRL_ADDR		EQU	34H
C_BMA253_OFFSET_CTRL_ADDR  		EQU	36H
C_BMA253_OFFSET_PARAMS_ADDR  	EQU	37H
C_BMA253_OFFSET_X_AXIS_ADDR		EQU	38H
C_BMA253_OFFSET_Y_AXIS_ADDR		EQU	39H
C_BMA253_OFFSET_Z_AXIS_ADDR		EQU	3AH
C_BMA253_GP0_ADDR	EQU	3BH
C_BMA253_GP1_ADDR	EQU	3CH
C_BMA253_FIFO_MODE_ADDR			EQU	3EH
C_BMA253_FIFO_DATA_OUTPUT_ADDR	EQU	3FH
;
C_SPIO_SETTING	EQU	00100001B	;SPIO clock=Fsys/2;SPIO Clock<10MHz, 22uS to read XYZ
;C_SPIO_SETTING	EQU	00000001B	;SPIO clock=Fsys;SPIO Clock<10MHz, 17uS to read XYZ


;================================================
;-2g:1
;-1g:64
; 0g:128
;+1g:196
;+2g:255


;0X09:INT_STATUS_0

C_DEEP_SUSPEND EQU 20H
C_NORMAL_MODE	EQU	00H
C_SOFERESET EQU 0B6H

;----------------------------------------------------------
;POR initial
;----------------------------------------------------------
	
	
C_SEL	EQU	12; FOR detect dir

C_SHIFT_PLUS EQU 128
;=============================
; about direction: 
;as datasheet:dot: left up
;=============================



;BMA222E_DIR = 0 ;IC_DOWN

C_IC_DOWN_X_MAX EQU	128+C_SEL
C_IC_DOWN_Y_MAX EQU	128+C_SEL
C_IC_DOWN_Z_MAX EQU	96+C_SEL
C_IC_DOWN_X_MIN EQU	128-C_SEL
C_IC_DOWN_Y_MIN EQU	128-C_SEL
C_IC_DOWN_Z_MIN EQU	96-C_SEL

;BMA222E_DIR = 1
C_IC_UP_X_MAX EQU	128+C_SEL
C_IC_UP_Y_MAX EQU	128+C_SEL
C_IC_UP_Z_MAX EQU	160+C_SEL
C_IC_UP_X_MIN EQU	128-C_SEL
C_IC_UP_Y_MIN EQU	128-C_SEL
C_IC_UP_Z_MIN EQU	160-C_SEL


;BMA222E_DIR = 2
C_IC_FRONT_X_MAX EQU	96+C_SEL
C_IC_FRONT_Y_MAX EQU	128+C_SEL
C_IC_FRONT_Z_MAX EQU	128+C_SEL
C_IC_FRONT_X_MIN EQU	96-C_SEL
C_IC_FRONT_Y_MIN EQU	128-C_SEL
C_IC_FRONT_Z_MIN EQU	128-C_SEL


;BMA222E_DIR = 3
C_IC_BACK_X_MAX EQU	160+C_SEL
C_IC_BACK_Y_MAX EQU	128+C_SEL
C_IC_BACK_Z_MAX EQU	128+C_SEL
C_IC_BACK_X_MIN EQU	160-C_SEL
C_IC_BACK_Y_MIN EQU	128-C_SEL
C_IC_BACK_Z_MIN EQU	128-C_SEL

;BMA222E_DIR = 4
C_IC_LEFT_X_MAX EQU	128+C_SEL
C_IC_LEFT_Y_MAX EQU	96+C_SEL
C_IC_LEFT_Z_MAX EQU	128+C_SEL
C_IC_LEFT_X_MIN EQU	128-C_SEL
C_IC_LEFT_Y_MIN EQU	96-C_SEL
C_IC_LEFT_Z_MIN EQU	128-C_SEL


;BMA222E_DIR = 5
C_IC_RIGHT_X_MAX EQU	128+C_SEL
C_IC_RIGHT_Y_MAX EQU	160+C_SEL
C_IC_RIGHT_Z_MAX EQU	128+C_SEL
C_IC_RIGHT_X_MIN EQU	128-C_SEL
C_IC_RIGHT_Y_MIN EQU	160-C_SEL
C_IC_RIGHT_Z_MIN EQU	128-C_SEL

;=======================================
C_UPSIDE_X_MAX EQU	 C_IC_LEFT_X_MAX
C_UPSIDE_Y_MAX EQU	 C_IC_LEFT_Y_MAX
C_UPSIDE_Z_MAX EQU	 C_IC_LEFT_Z_MAX
C_UPSIDE_X_MIN EQU	 C_IC_LEFT_X_MIN
C_UPSIDE_Y_MIN EQU	 C_IC_LEFT_Y_MIN
C_UPSIDE_Z_MIN EQU	 C_IC_LEFT_Z_MIN

C_DOWNSIDE_X_MAX EQU	 C_IC_RIGHT_X_MAX
C_DOWNSIDE_Y_MAX EQU	 C_IC_RIGHT_Y_MAX
C_DOWNSIDE_Z_MAX EQU	 C_IC_RIGHT_Z_MAX
C_DOWNSIDE_X_MIN EQU	 C_IC_RIGHT_X_MIN
C_DOWNSIDE_Y_MIN EQU	 C_IC_RIGHT_Y_MIN
C_DOWNSIDE_Z_MIN EQU	 C_IC_RIGHT_Z_MIN

C_FACEUP_X_MAX EQU	 C_IC_DOWN_X_MAX
C_FACEUP_Y_MAX EQU	 C_IC_DOWN_Y_MAX
C_FACEUP_Z_MAX EQU	 C_IC_DOWN_Z_MAX
C_FACEUP_X_MIN EQU	 C_IC_DOWN_X_MIN
C_FACEUP_Y_MIN EQU	 C_IC_DOWN_Y_MIN
C_FACEUP_Z_MIN EQU	 C_IC_DOWN_Z_MIN

C_FACEDOWN_X_MAX EQU	 C_IC_UP_X_MAX
C_FACEDOWN_Y_MAX EQU	 C_IC_UP_Y_MAX
C_FACEDOWN_Z_MAX EQU	 C_IC_UP_Z_MAX
C_FACEDOWN_X_MIN EQU	 C_IC_UP_X_MIN
C_FACEDOWN_Y_MIN EQU	 C_IC_UP_Y_MIN
C_FACEDOWN_Z_MIN EQU	 C_IC_UP_Z_MIN


C_LEFTSIDE_X_MAX EQU	 C_IC_BACK_X_MAX
C_LEFTSIDE_Y_MAX EQU	 C_IC_BACK_Y_MAX
C_LEFTSIDE_Z_MAX EQU	 C_IC_BACK_Z_MAX
C_LEFTSIDE_X_MIN EQU	 C_IC_BACK_X_MIN
C_LEFTSIDE_Y_MIN EQU	 C_IC_BACK_Y_MIN
C_LEFTSIDE_Z_MIN EQU	 C_IC_BACK_Z_MIN

C_RIGHTSIDE_X_MAX EQU	 C_IC_FRONT_X_MAX
C_RIGHTSIDE_Y_MAX EQU	 C_IC_FRONT_Y_MAX
C_RIGHTSIDE_Z_MAX EQU	 C_IC_FRONT_Z_MAX
C_RIGHTSIDE_X_MIN EQU	 C_IC_FRONT_X_MIN
C_RIGHTSIDE_Y_MIN EQU	 C_IC_FRONT_Y_MIN
C_RIGHTSIDE_Z_MIN EQU	 C_IC_FRONT_Z_MIN

C_RD_COMMAND EQU	80H
C_WR_COMMAND EQU	00H



C_UPSIDE_DIR EQU 0
C_DOWNSIDE_DIR EQU 1
C_FACEUP_DIR EQU 2
C_FACEDOWN_DIR EQU 3
C_LEFTSIDE_DIR EQU 4
C_RIGHTSIDE_DIR EQU 5
C_OTHER_DIR EQU 6

C_UPSIDE_DIR_BUF EQU 00H
C_DOWNSIDE_DIR_BUF EQU 10H
C_FACEUP_DIR_BUF EQU 20H
C_FACEDOWN_DIR_BUF EQU 30H
C_LEFTSIDE_DIR_BUF EQU 40H
C_RIGHTSIDE_DIR_BUF EQU 50H
C_OTHER_DIR_BUF EQU 60H

;C_DATA_BUF_SIZE EQU	30

;*64MS=700ms
C_GSENSOR_DIR_DEB_MASK EQU	11110000B
C_GSENSOR_DIR_DEB 			EQU	0F0H
C_GSENSOR_DIR_DEB_TEST 			EQU	050H
C_GSENSOR_DIR_DEB_INC 			EQU	00010000B

;
C_DIR_BUF_MASK	EQU 11110000B
C_DIR_BUF_MASKV	EQU 00001111B
C_DIR_MASK EQU	1111B


;C_BMA223_S_TAP_INT EQU	C_BIT5


;C_DIF_QUIET_X	EQU	32;1G	
;C_DIF_QUIET_Y	EQU	32;1G
;C_DIF_QUIET_Z	EQU	32;1G




;C_Gsensor_3G_Value EQU 96






