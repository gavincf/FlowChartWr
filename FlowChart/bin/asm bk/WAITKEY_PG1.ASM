;=========================================================================
; CODE2
;=========================================================================
;
;6144khz : 10ms
;used: A,X
L_DELAY10MS: ;61440 INS cycle
.IF ( C_CPU_CLOCK .EQ. 6144)
	LDX	#256-48
.ENDIF
.IF ( C_CPU_CLOCK .EQ. 20000)
	LDX	#256-156
.ENDIF

L_DELAY10MS_S10:
	LDA	#0
L_DELAY10MS_S20
	INC	A;2
	BNE	L_DELAY10MS_S20;3
	
	INX;2
	BNE	L_DELAY10MS_S10;3
	RTS
	
	
.if (CHIPSERIES = 'N567G') .OR. (CHIPSERIES = 'N567H') .OR. (CHIPSERIES = 'N567K') .OR. (CHIPSERIES = 'N588L')

BK0_START_TMG1_2MS: ; 2MS
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#191 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TSB	!IEF0
	RTS

BK0_START_TMG1_1MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#193 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TSB	!IEF0
	RTS

BK0_START_TMG1_05MS_W_CHK:
	LDA	#01H
	BIT	TMG1C ;START
	BNE	BK0_START_TMG1_05MS_END
BK0_START_TMG1_05MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#47 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TSB	!IEF0
BK0_START_TMG1_05MS_END:
	RTS

BK0_START_TMG1_0625MS: ; 2MS
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#59 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TSB	!IEF0
	RTS
BK0_START_TMG1_0250MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#23 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TSB	!IEF0
	RTS

BK0_START_TMG1_0125MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#11 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#04H
	TSB	!IEF0
	RTS


BK0_START_TMG1_07MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG1C ; SET CLK
	LDA	#67 ; +1
	STA	!TMG1V
	LDA	#01H
	TSB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TSB	!IEF0
	RTS
	
BK0_STOP_TMGX:
BK0_STOP_TMG1: ; 2MS
	LDA	#01H
	TRB	TMG1C ;START
	LDA	#TIMERG1_INT_BIT
	TRB	!IEF0
	RTS
.ENDIF
.if (CHIPSERIES = 'N588H') .OR. (CHIPSERIES = 'N588J')
BK0_START_TMG0_2MS: ; 2MS
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#191 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS

BK0_START_TMG0_05MS_W_CHK:
	LDA	#01H
	BIT	TMG0C ;START
	BNE	BK0_START_TMG0_05MS_END
BK0_START_TMG0_05MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#47 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
BK0_START_TMG0_05MS_END:
	RTS

BK0_START_TMG0_1MS_W_CHK:
	LDA	#01H
	BIT	TMG0C ;START
	BNE	BK0_START_TMG0_1MS_END
BK0_START_TMG0_1MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#95 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
BK0_START_TMG0_1MS_END:
	RTS

BK0_START_TMG0_0625MS: ; 2MS
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#59 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
BK0_START_TMG0_0250MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#23 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
BK0_START_TMG0_0240MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#22 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS

BK0_START_TMG0_027MS:
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#25 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
BK0_START_TMG0_0167MS:
	LDA	#0010B  ; / 8
	STA	!TMG0C ; SET CLK @6144000HZ,1.3US
	LDA	#101 ; +1==============> correct:127+1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS

BK0_START_TMG0_018MS:
	LDA	#0010B  ; / 8
	STA	!TMG0C ; SET CLK
	LDA	#138 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
BK0_START_TMG0_0187MS:
	LDA	#0010B  ; / 8
	STA	!TMG0C ; SET CLK
	LDA	#143 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
BK0_START_TMG0_0200MS:
	LDA	#0010B  ; / 8
	STA	!TMG0C ; SET CLK
	LDA	#152 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
	

BK0_START_TMG0_0125MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#11 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS


BK0_START_TMG0_07MS: ; 
	LDA	#0100B  ; / 64
	STA	!TMG0C ; SET CLK
	LDA	#67 ; +1
	STA	!TMG0V
	LDA	#01H
	TSB	TMG0C ;START
	LDA	#TIMERG0_INT_BIT
	TSB	!IEF0
	RTS
	
BK0_STOP_TMGX:
BK0_STOP_TMG0: ; 2MS
	LDA	#01H
	TRB	TMG0C ;STOP
	LDA	#TIMERG0_INT_BIT
	TRB	!IEF0
	RTS
.ENDIF

.if (CHIPSERIES = 'N589A') .OR. (CHIPSERIES = 'N589B') .OR. (CHIPSERIES = 'N589C') .OR. (CHIPSERIES = 'N589D')
;clock:Fsys = 10.24MHZ
BK0_START_TMG_1MS:
	
	LDA	#1100B  ; / 64
	STA	!TMGC ; SET CLK
	LDA	#00H
	STA	!TMGVH ; first
	LDA	#159 ; +1=160
	STA	!TMGVL ; second
	LDA	#01H
	TSB	TMGC ;START
	M_INT_ENABLE TIMERG_INT_BIT
	
	RTS
;clock:Fsys = 10.24MHZ
BK0_START_TMG_05MS:
	
	LDA	#1100B  ; / 64
	STA	!TMGC ; SET CLK
	LDA	#00H
	STA	!TMGVH ; @
	LDA	#79 ; +1=80
	STA	!TMGVL ; second
	LDA	#01H
	TSB	TMGC ;START
	M_INT_ENABLE TIMERG_INT_BIT
	
	RTS
;clock:Fsys = 10.24MHZ
BK0_START_TMG_025MS:
	
	LDA	#1100B  ; / 64
	STA	!TMGC ; SET CLK
	LDA	#00H
	STA	!TMGVH ; @6.25US
	LDA	#39 ; +1=40
	STA	!TMGVL ; second
	LDA	#01H
	TSB	TMGC ;START
	M_INT_ENABLE TIMERG_INT_BIT
	
	RTS

;clock:Fsys = 10.24MHZ
BK0_START_TMA_2MS:
	
	LDA	#1000B  ; / 128
	STA	!TMAC ; SET CLK
	LDA	#159 ; +1=160
	STA	!TMAV ; second
	LDA	#01H
	TSB	TMAC ;START
	M_INT_ENABLE TIMERA_INT_BIT
	
	RTS
;clock:Fsys = 10.24MHZ
BK0_START_TMA_045MS:
;12.5US
	LDA	#1000B  ; / 128
	STA	!TMAC ; SET CLK
	LDA	#35 ; +1=36
	STA	!TMAV ; second
	LDA	#01H
	TSB	TMAC ;START
	M_INT_ENABLE TIMERA_INT_BIT
	
	RTS
;clock:Fsys = 10.24MHZ
BK0_STOP_TMA:
	
	M_INT_DISABLE TIMERA_INT_BIT
	LDA	#01H
	TRB	TMAC ;STOP
	
	RTS

BK0_STOP_TMGX:
BK0_STOP_TMG:
	M_INT_DISABLE TIMERG_INT_BIT
	LDA	#01H
	TRB	TMGC ;STOP

	RTS
.ENDIF

;===================================
L_DELAY100US:
;6144KHz: 100US*6=600
;600/9=67
;
.IF ( C_CPU_CLOCK .EQ. 6144)
	LDA #67
.ENDIF
;20000KHz: 100US*20=2000
;2000/9=222
.IF ( C_CPU_CLOCK .EQ. 20000)
	LDA #222
.ENDIF

L_DELAY100US_S10:
	NOP	; 2
	NOP	; 2
	DEC A		;2
	BNE L_DELAY100US_S10	;3
	RTS	; 1.5US


.IF ( C_CPU_CLOCK .EQ. 6144)
BK0_DELAY10US:
	LDA #5
	BRA	BK0_DELAY100US_S10


BK0_DELAY50US:
;6144KHz: 50US*6=300
;300/9=67
;
	LDA #33
	BRA	BK0_DELAY100US_S10

BK0_DELAY100US:
;6144KHz: 100US*6=600
;600/9=67
;
	LDA #67
BK0_DELAY100US_S10:
	NOP	; 2
	NOP	; 2
	DEC A		;2
	BNE BK0_DELAY100US_S10	;3
	RTS	; 1.5US


BK0_DELAY500US:
;6144KHz: 50US*6=300
;300/9=67
;
	LDA #120
	BRA	BK0_DELAY1000US_S10

BK0_DELAY1MS:
;6144KHz: 1000US*6=6000
;6000/25=240
;
	LDA #240
BK0_DELAY1000US_S10:
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2

	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	
	DEC A		;2
	BNE BK0_DELAY1000US_S10	;3
	RTS	; 1.5US



;=========================
BK0_DELAY50MS:
	LDX	#250
	
BK0_DELAY50MS_S10:
	M_WDT_CLR

	JSR	BK0_DELAY100US; A
	JSR	BK0_DELAY100US;	A
	DEX
	BNE	BK0_DELAY50MS_S10
	RTS

BK0_DELAY10MS:
	LDX	#50
BK0_DELAY10MS_S10:
	M_WDT_CLR

	JSR	BK0_DELAY100US; A
	JSR	BK0_DELAY100US;	A
	DEX
	BNE	BK0_DELAY10MS_S10
	RTS
.ENDIF ;( C_CPU_CLOCK .EQ. 6144)
;
.IF ( C_CPU_CLOCK .EQ. 20000)
BK0_DELAY500US:
;6144KHz: 50US*6=300
;300/9=67
;
	LDX	#5
	BRA	BK0_DELAY100US_S10

BK0_DELAY1MS:
	LDX	#10
;
BK0_DELAY100US_S10:;100US
	LDA #80
BK0_DELAY100US_S20:
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	NOP	; 2
	
	DEC A		;2
	BNE BK0_DELAY100US_S20	;3
	DEX
	BNE	BK0_DELAY100US_S10
	RTS	; 1.5US
	
.ENDIF ;( C_CPU_CLOCK .EQ. 20000)

;====================================
;====================================

