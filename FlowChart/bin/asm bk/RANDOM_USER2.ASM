
.IF ( C_RANDOM_GP_USED .EQ. 1)

RANDOM_GP_BUF_INIT:
	LDX	#0
RANDOM_GP_BUF_INIT_S10:
	LDA	#0FFH
	STA	R_RANDOM_GP_BUF,X	
	INX
	CPX	#C_RANDOM_GP_CNT
	BCC	RANDOM_GP_BUF_INIT_S10
	
	RTS


;===========================================
;R_RANDOM_GP_BUF,X
;IN: X,R_RANDOM_GP_NO
;OUT:A
;=======================================
L_GET_RANDOM_GP:
;1, select table
	LDX	R_RANDOM_GP_NO
	LDA	R_RANDOM_GP_BUF,X; group random no
	CMP	#0FFH
	BNE	L_GET_RANDOM_GP_NEXT ;NEXT
;new group;1st time
	LDA	T_RANDOM_BUF_MAX,X
	TAX
	LDA	T_RANDOM_TABLE_CNT,X
	CMP	#1
	BEQ	L_GET_RANDOM_GP_S10; ONLY 1 RANDOM GROUP
	STA	REG_EA
	JSR	BK0_GET_RANDOM0 ;set REG_EA
	LDA	REG_EA
	CMP	RANDOM0_0_BK
	BNE	L_GET_RANDOM_GP_S20
	INC	REG_EA
	CPX REG_EA
	BNE	L_GET_RANDOM_GP_S20
	STZ	REG_EA
	BRA	L_GET_RANDOM_GP_S20
L_GET_RANDOM_GP_S10:
	STZ	REG_EA
;
L_GET_RANDOM_GP_S20:
	LDA	REG_EA
	STA	RANDOM0_0_BK
	
;REG_EA; 1st time: group no
	STZ	REG_HL ;temp used
	LDX	<R_RANDOM_GP_NO
L_GET_RANDOM_GP_S21:
	LDA	REG_EA ; group no
	BEQ	L_GET_RANDOM_GP_S30
	LDA	T_RANDOM_BUF_MAX,X
	CLC
	ADC	REG_HL
	STA	REG_HL
	DEC	REG_EA ; -1
	BRA	L_GET_RANDOM_GP_S21
L_GET_RANDOM_GP_S30:
	LDA	REG_HL
	STA	R_RANDOM_GP_BUF,X; STORE TO each BUF
	BRA	L_GET_RANDOM_GP_S100
;
L_GET_RANDOM_GP_NEXT: ; next time
	LDX	<R_RANDOM_GP_NO
	LDA	R_RANDOM_GP_BUF,X ; +1
	CLC
	ADC	#1
	STA	R_RANDOM_GP_BUF,X; STORE TO each BUF
	
L_GET_RANDOM_GP_S100:
	LDX	<R_RANDOM_GP_NO
	LDY	R_RANDOM_GP_BUF,X

	LDA	T_RANDOM_BUF_MAX,X
	ASL	A
	TAX
	LDA	BK0_RANDOM_TBL,X
	STA	REG_EA
	INX
	LDA	BK0_RANDOM_TBL,X
	STA	REG_HL
;
	LDA	(<REG_EA),Y
	CMP	#0FFH
	BNE	L_GET_RANDOM_GP_EXIT
	LDX	<R_RANDOM_GP_NO
	LDA	#0
	STA	<R_RANDOM_GP_BUF,X ;reset
	BRA	L_GET_RANDOM_GP_S100
L_GET_RANDOM_GP_EXIT:;OUT:ACC
	TAY ;Y: random group TABLE sel

	RTS
;===================================================
;	L_GET_RANDOM_GP_DATA
;in: Y
;output:ACC
;
;===================================================
L_GET_RANDOM_GP_DATA:
	LDA	<R_RANDOM_GP_NO
	ASL	A
	TAX
	LDA	T_RANDOM_GROUP,X ; EQU TABLE
	STA	<REG_EA
	INX
	LDA	T_RANDOM_GROUP,X ; EQU TABLE
	STA	<REG_HL

;Y: table sel
	LDA	(<REG_EA),Y
;=================================
;	USE for; SPEECH NO / EQU NO /other
;=================================
	RTS


.ENDIF ; C_RANDOM_GP_USED