
POR_MODULE_PCC_BMA253 EQU C_TRUE
.IF(POR_MODULE_PCC_BMA253.EQ.C_FALSE)
	JSR	F_BMA253_Init
.ENDIF;POR_MODULE_PCC_BMA253


WAITKEY_GAP2_PCC_BMA253 EQU C_TRUE
.IF(WAITKEY_GAP2_PCC_BMA253.EQ.C_FALSE)
	JSR F_BMA253_ReadXYZ
;
	
	JSR F_Gsensor_SaveXYZ
	JSR	L_GET_AVR_P
;
	JMP	L_CHK_6_DIR
L_CHK_6_DIR_RET:

.ENDIF;WAITKEY_GAP2_PCC_BMA253
;=========================================================================
; CODE
;=========================================================================
L_CHK_6_DIR:
;check XYZ
	LDX	R_Gsensor_SaveP
	TXA
	BNE	L_CHK_6_DIR_S10
	LDX	#C_Gdata_STotal
L_CHK_6_DIR_S10:
	DEX
;
;=======================
;check direction
CHK_UPSIDE:
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_UPSIDE_X_MAX
	BCS	CHK_DOWNSIDE_J1
	CMP	#C_UPSIDE_X_MIN
	BCC	CHK_DOWNSIDE_J1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_UPSIDE_Y_MAX
	BCS	CHK_DOWNSIDE_J1
	CMP	#C_UPSIDE_Y_MIN
	BCC	CHK_DOWNSIDE_J1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_UPSIDE_Z_MAX
	BCS	CHK_DOWNSIDE_J1
	CMP	#C_UPSIDE_Z_MIN
	BCC	CHK_DOWNSIDE_J1
;
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_UPSIDE_DIR
	BEQ	CHK_UPSIDE_SAME
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_UPSIDE_DIR_BUF
	BEQ	CHK_UPSIDE_S10
	
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_UPSIDE_DIR_BUF
	STA	DIR6_FLAG
	
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
	
CHK_BMA222E_END_J1:
	JMP	L_CHK_6_DIR_END
CHK_DOWNSIDE_J1:
	BRA	CHK_DOWNSIDE
	
CHK_UPSIDE_SAME:

	JMP	L_CHK_6_DIR_END
CHK_UPSIDE_S10:
	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY
	
;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_UPSIDE_S11
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB
	BNE	CHK_BMA222E_END_J1
	BRA	CHK_UPSIDE_TRIG
CHK_UPSIDE_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J1
	
CHK_UPSIDE_TRIG:
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY

	LDA	#C_UPSIDE_DIR
	STA	DIR6_FLAG
;
;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	L_CHK_6_DIR_END_J1
;	M_SET_KEYCH2_FLAG
	
L_CHK_6_DIR_END_J1:
	JMP	L_CHK_6_DIR_END
;
CHK_DOWNSIDE:
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_DOWNSIDE_X_MAX
	BCS	CHK_FACEUP_J1
	CMP	#C_DOWNSIDE_X_MIN
	BCC	CHK_FACEUP_J1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_DOWNSIDE_Y_MAX
	BCS	CHK_FACEUP_J1
	CMP	#C_DOWNSIDE_Y_MIN
	BCC	CHK_FACEUP_J1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_DOWNSIDE_Z_MAX
	BCS	CHK_FACEUP_J1
	CMP	#C_DOWNSIDE_Z_MIN
	BCC	CHK_FACEUP_J1
;G-SENSOR VALUE CORRECT
;
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_DOWNSIDE_DIR
	BEQ	CHK_DOWNSIDE_SAME
;DIF DIR
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_DOWNSIDE_DIR_BUF
	BEQ	CHK_DOWNSIDE_S10_J1
;DIF DIR BUF
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_DOWNSIDE_DIR_BUF
	STA	DIR6_FLAG
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
CHK_BMA222E_END_J2:
	JMP	L_CHK_6_DIR_END
CHK_DOWNSIDE_S10_J1:
	JMP	CHK_DOWNSIDE_S10
CHK_FACEUP_J1:
	JMP	CHK_FACEUP
	
CHK_DOWNSIDE_SAME:;repeat
	LDA	DIR6_CNT
	BEQ	CHK_BMA222E_END_J2
	INC	DIR6_CNT
	BNE	CHK_BMA222E_END_J2
;
	JMP	CHK_DOWNSIDE_TRIG

CHK_DOWNSIDE_S10:;COUNT DIR DEBOUNCE

	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY

;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_DOWNSIDE_S11
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB
	BNE	CHK_BMA222E_END_J21
	
	BRA	CHK_DOWNSIDE_TRIG
CHK_DOWNSIDE_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J21

CHK_DOWNSIDE_TRIG:
;GET DIR
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
	
	LDA	#C_DOWNSIDE_DIR
	STA	DIR6_FLAG
;repeat

;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	CHK_DOWNSIDE_TRIG_S100
	
	M_SET_KEYCH2_FLAG
	JMP	L_CHK_6_DIR_END

CHK_DOWNSIDE_TRIG_S100:
	
;	M_CMP_MODE_NO	 C_M0SF_MODE
;	BEQ	CHK_DOWNSIDE_S110;SLEEP MODE
	
	LDA	#256-4000/C_GAP2
	STA	DIR6_CNT

	M_SET_KEYCH2_FLAG
;	M_SET_MOTION_NO C_DOWNSIDE_MODE

CHK_DOWNSIDE_S110:


CHK_DOWNSIDE_EXIT:
	
	JMP	L_CHK_6_DIR_END

;
CHK_BMA222E_END_J21:
	JMP	L_CHK_6_DIR_END

CHK_FACEUP:
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_FACEUP_X_MAX
	BCS	CHK_FACEDOWN_J1
	CMP	#C_FACEUP_X_MIN
	BCC	CHK_FACEDOWN_J1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_FACEUP_Y_MAX
	BCS	CHK_FACEDOWN_J1
	CMP	#C_FACEUP_Y_MIN
	BCC	CHK_FACEDOWN_J1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_FACEUP_Z_MAX
	BCS	CHK_FACEDOWN_J1
	CMP	#C_FACEUP_Z_MIN
	BCC	CHK_FACEDOWN_J1
	
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_FACEUP_DIR
	BEQ	CHK_FACEUP_SAME
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_FACEUP_DIR_BUF
	BEQ	CHK_FACEUP_S10
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_FACEUP_DIR_BUF
	STA	DIR6_FLAG
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
CHK_BMA222E_END_J3:
	JMP	L_CHK_6_DIR_END
	
CHK_FACEDOWN_J1:
	JMP	CHK_FACEDOWN
	
CHK_FACEUP_SAME:
	LDA	DIR6_CNT
	BEQ	CHK_BMA222E_END_J3
	INC	DIR6_CNT
	BNE	CHK_BMA222E_END_J3

	JMP	CHK_FACEUP_TRIG
	
CHK_FACEUP_S10:
	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY
	
;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_FACEUP_S11
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB
	BNE	CHK_BMA222E_END_J3
	BRA	CHK_FACEUP_TRIG
CHK_FACEUP_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J3

CHK_FACEUP_TRIG:
;GET DIR
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
	
	LDA	#C_FACEUP_DIR
	STA	DIR6_FLAG
	
;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	CHK_FACEUP_TRIG_S100
	M_SET_KEYCH2_FLAG
	JMP	L_CHK_6_DIR_END

CHK_FACEUP_TRIG_S100:
;repeat 

	STZ	DIR6_CNT
	
;	M_SET_MOTION_NO C_LAYDOWN_MODE
	M_SET_KEYCH2_FLAG
	
CHK_FACEUP_EXIT:
	JMP	L_CHK_6_DIR_END


CHK_FACEDOWN:
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_FACEDOWN_X_MAX
	BCS	CHK_LEFTSIDE_J1
	CMP	#C_FACEDOWN_X_MIN
	BCC	CHK_LEFTSIDE_J1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_FACEDOWN_Y_MAX
	BCS	CHK_LEFTSIDE_J1
	CMP	#C_FACEDOWN_Y_MIN
	BCC	CHK_LEFTSIDE_J1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_FACEDOWN_Z_MAX
	BCS	CHK_LEFTSIDE_J1
	CMP	#C_FACEDOWN_Z_MIN
	BCC	CHK_LEFTSIDE_J1
	
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_FACEDOWN_DIR
	BEQ	CHK_FACEDOWN_SAME
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_FACEDOWN_DIR_BUF
	BEQ	CHK_FACEDOWN_S10
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_FACEDOWN_DIR_BUF
	STA	DIR6_FLAG
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
CHK_BMA222E_END_J4:
	JMP	L_CHK_6_DIR_END
CHK_LEFTSIDE_J1:
	BRA	CHK_LEFTSIDE
CHK_FACEDOWN_SAME:

	JMP	L_CHK_6_DIR_END
CHK_FACEDOWN_S10:
	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY

;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_FACEDOWN_S11
;	LDA	GSENSOR_DLY
;	AND	#C_GSENSOR_DIR_DEB_MASK
;	CMP	#C_GSENSOR_DIR_DEB
;	BNE	CHK_BMA222E_END_J4
;	BRA	CHK_FACEDOWN_TRIG
CHK_FACEDOWN_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J4
	
CHK_FACEDOWN_TRIG:
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY

	LDA	#C_FACEDOWN_DIR
	STA	DIR6_FLAG
;	
;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	L_CHK_6_DIR_END_J2

	M_SET_KEYCH2_FLAG
	
L_CHK_6_DIR_END_J2:
	JMP	L_CHK_6_DIR_END
	

CHK_LEFTSIDE:
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_LEFTSIDE_X_MAX
	BCS	CHK_RIGHTSIDE_J1
	CMP	#C_LEFTSIDE_X_MIN
	BCC	CHK_RIGHTSIDE_J1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_LEFTSIDE_Y_MAX
	BCS	CHK_RIGHTSIDE_J1
	CMP	#C_LEFTSIDE_Y_MIN
	BCC	CHK_RIGHTSIDE_J1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_LEFTSIDE_Z_MAX
	BCS	CHK_RIGHTSIDE_J1
	CMP	#C_LEFTSIDE_Z_MIN
	BCC	CHK_RIGHTSIDE_J1
	
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_LEFTSIDE_DIR
	BEQ	CHK_LEFTSIDE_SAME
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_LEFTSIDE_DIR_BUF
	BEQ	CHK_LEFTSIDE_S10
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_LEFTSIDE_DIR_BUF
	STA	DIR6_FLAG
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
CHK_BMA222E_END_J5:
	JMP	L_CHK_6_DIR_END
CHK_RIGHTSIDE_J1:
	BRA	CHK_RIGHTSIDE
	
CHK_LEFTSIDE_SAME:

	JMP	L_CHK_6_DIR_END
CHK_LEFTSIDE_S10:
	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY

;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_LEFTSIDE_S11
;	LDA	GSENSOR_DLY
;	AND	#C_GSENSOR_DIR_DEB_MASK
;	CMP	#C_GSENSOR_DIR_DEB
;	BNE	CHK_BMA222E_END_J5
;	BRA	CHK_LEFTSIDE_TRIG
CHK_LEFTSIDE_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J5
	
CHK_LEFTSIDE_TRIG:
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY

	LDA	#C_LEFTSIDE_DIR
	STA	DIR6_FLAG
;	
;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	L_CHK_6_DIR_END_J3
	M_SET_KEYCH2_FLAG

L_CHK_6_DIR_END_J3:
	JMP	L_CHK_6_DIR_END

CHK_RIGHTSIDE:
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_RIGHTSIDE_X_MAX
	BCS	CHK_OTHER_J1
	CMP	#C_RIGHTSIDE_X_MIN
	BCC	CHK_OTHER_J1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_RIGHTSIDE_Y_MAX
	BCS	CHK_OTHER_J1
	CMP	#C_RIGHTSIDE_Y_MIN
	BCC	CHK_OTHER_J1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	CMP	#C_RIGHTSIDE_Z_MAX
	BCS	CHK_OTHER
	CMP	#C_RIGHTSIDE_Z_MIN
	BCC	CHK_OTHER
	
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_RIGHTSIDE_DIR
	BEQ	CHK_RIGHTSIDE_SAME
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_RIGHTSIDE_DIR_BUF
	BEQ	CHK_RIGHTSIDE_S10
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_RIGHTSIDE_DIR_BUF
	STA	DIR6_FLAG
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
	
CHK_BMA222E_END_J6:
	JMP	L_CHK_6_DIR_END
CHK_OTHER_J1:
	BRA	CHK_OTHER
	
CHK_RIGHTSIDE_SAME:

	JMP	L_CHK_6_DIR_END
CHK_RIGHTSIDE_S10:
	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY

;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_RIGTHSIDE_S11
;	LDA	GSENSOR_DLY
;	AND	#C_GSENSOR_DIR_DEB_MASK
;	CMP	#C_GSENSOR_DIR_DEB
;	BNE	CHK_BMA222E_END_J6
;	BRA	CHK_RIGTHSIDE_TRIG
CHK_RIGTHSIDE_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J6
	
CHK_RIGTHSIDE_TRIG:
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY

	LDA	#C_RIGHTSIDE_DIR
	STA	DIR6_FLAG
;	
;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	L_CHK_6_DIR_END_J4
	M_SET_KEYCH2_FLAG

L_CHK_6_DIR_END_J4:
	JMP	L_CHK_6_DIR_END

CHK_OTHER:
	
	LDA	DIR6_FLAG
	AND	#C_DIR_MASK
	CMP	#C_OTHER_DIR
	BEQ	CHK_OTHER_SAME

	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASK
	CMP	#C_OTHER_DIR_BUF
	BEQ	CHK_OTHER_S10
	LDA	DIR6_FLAG
	AND	#C_DIR_BUF_MASKV
	ORA	#C_OTHER_DIR_BUF
	STA	DIR6_FLAG
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
CHK_BMA222E_END_J7:
	JMP	L_CHK_6_DIR_END

CHK_OTHER_SAME:
	
	JMP	L_CHK_6_DIR_END
CHK_OTHER_S10:
	CLC
	LDA	GSENSOR_DLY
	ADC	#C_GSENSOR_DIR_DEB_INC
	STA	GSENSOR_DLY

;	M_CMP_MODE_NO C_TEST0_KEY
;	BEQ	CHK_OTHER_S11
;	LDA	GSENSOR_DLY
;	AND	#C_GSENSOR_DIR_DEB_MASK
;	CMP	#C_GSENSOR_DIR_DEB
;	BNE	CHK_BMA222E_END_J7
;	BRA	CHK_OTHER_TRIG
CHK_OTHER_S11:
	LDA	GSENSOR_DLY
	AND	#C_GSENSOR_DIR_DEB_MASK
	CMP	#C_GSENSOR_DIR_DEB_TEST
	BNE	CHK_BMA222E_END_J7
	
CHK_OTHER_TRIG:
	LDA	#C_GSENSOR_DIR_DEB_MASK
	TRB	GSENSOR_DLY
;
	LDA	#C_OTHER_DIR
	STA	DIR6_FLAG
;	
;	M_CMP_SYS_MODE_NO C_TEST0_MODE
;	BNE	L_CHK_6_DIR_END_J4
;	M_SET_KEYCH2_FLAG
L_CHK_6_DIR_END_J5:
	
	JMP	L_CHK_6_DIR_END

L_CHK_6_DIR_END:
;

	JMP L_CHK_6_DIR_RET

;=========================================================================
; CODE1
;=========================================================================
L_GET_AVR_P_POR:;100%
	LDX	R_Gsensor_SaveP
	TXA
	BNE	L_GET_AVR_S10
	LDX	#C_Gdata_STotal
L_GET_AVR_S10:
	DEX
;DEBUG
	LDX	#0
;
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	XAVR_P
;
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	YAVR_P
;
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	STA	ZAVR_P
	RTS


;========================================
L_GET_AVR_P:
	LDA	R_1ST_AVR_CNT
	CMP	#16
	BCS	L_GET_AVR_P_S1000
	INC	R_1ST_AVR_CNT
	LDA	R_1ST_AVR_CNT
	CMP	#16
	BCC	L_GET_AVR_P_EXIT
	LDA	#111B
	STA	R_AVR_FLAG
	STA	R_AVR1_FLAG
	BRA	L_GET_AVR_P_S1000
L_GET_AVR_P_EXIT:
	RTS
L_GET_AVR_P_S1000:
	LDA	R_AVR_FLAG
	BIT	#C_BIT0
	BEQ	L_GET_AVR_P_S1200
	JSR	L_GET_AVR_X_P
	STA	XAVR_P
;

L_GET_AVR_P_S1200:
	LDA	R_AVR_FLAG
	BIT	#C_BIT1
	BEQ	L_GET_AVR_P_S1300
	JSR	L_GET_AVR_Y_P
	STA	YAVR_P
;

L_GET_AVR_P_S1300:
	LDA	R_AVR_FLAG
	BIT	#C_BIT2
	BEQ	L_GET_AVR_P_S2000
	JSR	L_GET_AVR_Z_P
	STA	ZAVR_P
;
L_GET_AVR_P_S2000:
;
;	LDA	R_AVR1_FLAG
;	BIT	#C_BIT0
;	BEQ	L_GET_AVR_P_S2200
;	JSR	L_GET_AVR_X_P
;	STA	XAVR1_P
;
;L_GET_AVR_P_S2200:
;	LDA	R_AVR1_FLAG
;	BIT	#C_BIT1
;	BEQ	L_GET_AVR_P_S2300
;	JSR	L_GET_AVR_Y_P
;	STA	YAVR1_P
;
;L_GET_AVR_P_S2300:
;	LDA	R_AVR1_FLAG
;	BIT	#C_BIT2
;	BEQ	L_GET_AVR_P_S3000
;	JSR	L_GET_AVR_Z_P
;	STA	ZAVR1_P
;;
;L_GET_AVR_P_S3000:
	RTS

;-----------------------------------	
L_GET_AVR_X_P:
	STZ	REG_EA
	STZ	REG_HL
	STZ	DP_ADDR
	
	LDA	R_Gsensor_SaveP
	STA	DP_ADDR+1
L_GET_AVR_P_S1110:
	LDX	DP_ADDR+1
	BNE	L_GET_AVR_P_S1120
	LDX	#32
L_GET_AVR_P_S1120:
	DEX
	STX	DP_ADDR+1
	LDA	R_SaveX_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	ADC	REG_EA
	STA	REG_EA
	LDA	REG_HL
	ADC	#0
	STA	REG_HL
;
	INC	DP_ADDR
	LDA	DP_ADDR
	CMP	#16
	BCC	L_GET_AVR_P_S1110
;/16
	
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LDA	REG_EA
	RTS
;------------------------
L_GET_AVR_Y_P:
	STZ	REG_EA
	STZ	REG_HL
	STZ	DP_ADDR
	
	LDA	R_Gsensor_SaveP
	STA	DP_ADDR+1
L_GET_AVR_P_S1210:
	LDX	DP_ADDR+1
	BNE	L_GET_AVR_P_S1220
	LDX	#32
L_GET_AVR_P_S1220:
	DEX
	STX	DP_ADDR+1
	LDA	R_SaveY_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	ADC	REG_EA
	STA	REG_EA
	LDA	REG_HL
	ADC	#0
	STA	REG_HL
;
	INC	DP_ADDR
	LDA	DP_ADDR
	CMP	#16
	BCC	L_GET_AVR_P_S1210
;/16
	
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LDA	REG_EA
	RTS
;-----------------
L_GET_AVR_Z_P:
	STZ	REG_EA
	STZ	REG_HL
	STZ	DP_ADDR
	
	LDA	R_Gsensor_SaveP
	STA	DP_ADDR+1
L_GET_AVR_P_S1310:
	LDX	DP_ADDR+1
	BNE	L_GET_AVR_P_S1320
	LDX	#32
L_GET_AVR_P_S1320:
	DEX
	STX	DP_ADDR+1
	LDA	R_SaveZ_Base,X
	CLC
	ADC	#C_SHIFT_PLUS
	ADC	REG_EA
	STA	REG_EA
	LDA	REG_HL
	ADC	#0
	STA	REG_HL
;
	INC	DP_ADDR
	LDA	DP_ADDR
	CMP	#16
	BCC	L_GET_AVR_P_S1310
;/16
	
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LSR	REG_HL
	ROR	REG_EA
	LDA	REG_EA
	RTS



;=========================================================================
; CODE2
;=========================================================================
BMA222E_DeepSuspend:
	LDA	#PMU_LPW
	STA	R_BMA253_Addr
	LDA	#C_DEEP_SUSPEND
	STA	R_BMA253_Data
	JSR F_BMA253_Write1byte
	RTS


BMA222E_RESET_TO_NORMAL:
	LDA	#BGW_SOFTRESET
	STA	R_BMA253_Addr
	LDA	#C_SOFERESET
	STA	R_BMA253_Data
	JSR F_BMA253_Write1byte
	
	JSR	BK0_DELAY1MS
	JSR	BK0_DELAY1MS
	JSR	BK0_DELAY1MS
	JSR	BK0_DELAY1MS
	JSR	BK0_DELAY1MS

;=============================================
BMA222E_Normal:
	LDA	#PMU_LPW
	STA	R_BMA253_Addr
	LDA	#C_NORMAL_MODE
	STA	R_BMA253_Data
	JSR F_BMA253_Write1byte

	RTS
BMA222E_S_TAP_SET:

;;TAP setting
		MR_BMA222E_WR INT_OUT_CTRL,02H; open drain for INT1 PIN
		MR_BMA222E_WR INT_MAP_0,20H;  map single tap to INT1 PIN
		MR_BMA222E_WR INT_RST_LATCH,8CH	;Reset+ int flag remain time: 12.5ms
		MR_BMA222E_WR INT_8,00H	;TAG SETTING:tap quiet:30ms,tap shock:50ms,tap dur:50ms,
		MR_BMA222E_WR INT_9,46H	;6*0.125mg(4G range);TAP THRESHOLD level
	;S TAP not enable yet 
;		JSR	F_BMA253_Enable_Int;start
		MR_BMA222E_WR INT_EN_0,20H ;enable single tap interrupt enable

	RTS
; check s tap flag
;	MR_BMA222E_RD INT_STATUS_0
;	LDA	R_BMA253_rtn
;	BIT	#C_BIT5
;	BEQ	WAITKEY_CHK_PCC_S10
;s tap trig
;	M_SET_KEYCH1_FLAG
;
;WAITKEY_CHK_PCC_S10:	


